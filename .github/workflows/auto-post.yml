name: Auto Post to WordPress

on:
  # 매일 한국 시간 오전 9시 (UTC 0시)에 자동 실행
  schedule:
    - cron: '0 0 * * *'  # 매일 UTC 00:00 = 한국시간 09:00
  
  # 수동 실행도 가능
  workflow_dispatch:

jobs:
  post-to-wordpress:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run WordPress Auto Posting Bot
      env:
        # GitHub Secrets에서 민감한 정보를 가져옴
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        WORDPRESS_URL: ${{ secrets.WORDPRESS_URL }}
        WORDPRESS_USERNAME: ${{ secrets.WORDPRESS_USERNAME }}
        WORDPRESS_APP_PASSWORD: ${{ secrets.WORDPRESS_APP_PASSWORD }}
        WORDPRESS_CATEGORY_ID: ${{ secrets.WORDPRESS_CATEGORY_ID }}
        POST_STATUS: 'publish'
        UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
      run: |
        python wordpress_bot.py
    
    - name: Upload logs (if needed)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: posting-logs
        path: |
          *.log
          *.txt
        retention-days: 7
